<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta charset="utf-8">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
    <title>Browser Text Box</title>
    <style>
        body, html, #myContent {
            height: 100%;
            width: 100%;
        }

        body {
            margin: 0;
            padding: 0;
        }

        #myContent {
            font-size: 16px;
            font-family: Tahoma;
            font-weight: bold;
            color: brown;
            background-color: lightblue;
            /* border: 2px blue;
            border-style: solid;*/
            margin: 0;
            padding: 0;
        }

        .disabled {
            background: #f0f0f0;
        }

        p {
            margin: 1px;
            padding: 0;
        }

        html {
            -ms-content-zooming: none; /* Disables zooming */
        }
    </style>
</head>
<body>
    <div contenteditable="true" id="myContent" dir="ltr" style="text-align:center"></div>
    <div id="div1"></div>
    <script>
        window.addEventListener("keydown",
            function (e) {
                if (e.keyCode === 114 || (e.ctrlKey && e.keyCode === 70)) {
                    // prevent find dialog
                    e.preventDefault();
                } else if (e.ctrlKey === true &&
                    (e.keyCode === 61 ||
                        e.keyCode === 107 ||
                        e.keyCode === 173 ||
                        e.keyCode === 109 ||
                        e.keyCode === 187 ||
                        e.keyCode === 189)) {
                    // prevent zoom
                    e.preventDefault();
                }
            });

        // Use a more terse method for getting by id
        function getById(id) {
            return document.getElementById(id);
        }

        //function syntaxColorIfNotActive() {
        //    setTimeout(function () {
        //        window.external.UpdateSyntaxColorFromJs(getText(), document.getElementById("myContent").innerHTML);
        //    }, 1);
        //}

        function initEvents() {
            getById("myContent").addEventListener("focus", function (e) {
                window.external.ClientFocus();
            });

            getById("myContent").addEventListener("blur", function (e) {
                window.external.ClientBlur();
            });

            getById("myContent").addEventListener("keydown", function (e) {
                window.external.ClientKeyDown(e.keyCode, e.ctrlKey, e.shiftKey, e.altKey);
            });

            getById("myContent").addEventListener("keyup", function (e) {
                window.external.ClientKeyUp(e.keyCode, e.ctrlKey, e.shiftKey, e.altKey);
//                syntaxColorIfNotActive();
            });

            getById("myContent").addEventListener("click", function (e) {
                window.external.ClientClick();
//                syntaxColorIfNotActive();
            });

            getById("myContent").addEventListener("mousemove", function (e) {
                window.external.ClientMouseMove();
            });
        }

        function getLengthFromChildren(node, txtObj, top) {
            while (node != null) {
                if (node.firstChild) {
                    if (node.nodeName === "P" || node.nodeName === "DIV") {
                        txtObj.l += 2;
                    }
                    getLengthFromChildren(node.firstChild, txtObj, false);
                } else {
                    if (node.nodeType === 3) {
                        txtObj.l += node.nodeValue.length;
                    } else if (node.nodeName === "P" || node.nodeName === "DIV") {
                        txtObj.l += 2;
                    } else if (node.nodeName === "BR" && node.parentNode.nodeName !== "P" && node.parentNode.nodeName !== "DIV") {
                        txtObj.l += 2;
                    } else if (node.innerHTML === "<br>" && node.nodeName !== "P" && node.nodeName !== "DIV") {
                        txtObj.l += 2;
                    }
                }
                if (top) {
                    return;
                }
                node = node.nextSibling;
            }
            return;
        }

        function getNodePosition(node, txtObj) {
            if (!node) {
                return txtObj.l;
            }

            while (true) {
                if (node.previousSibling) {
                    node = node.previousSibling;
                } else {
                    var p = node.parentNode;
                    if (p.id === "myContent") {
                        return txtObj.l;
                    }

                    if (p.previousSibling) {
                        node = p.previousSibling;
                    } else {
                        p = node.parentNode.parentNode;
                        if (p && p.id === "myContent" || (p && p.nodeName === "P" && p.parentNode && p.parentNode.id === "myContent")) {
                            return txtObj.l;
                        }

                        if (p && p.parentNode && p.parentNode.previousSibling) {
                            node = p.parentNode.previousSibling;
                        } else {
                            return txtObj.l;
                        }
                    }
                }

                getLengthFromChildren(node, txtObj, true);
            }
        }

        function getCursorPosition() {
            var x = window.getSelection();
            return getNodePosition(x.focusNode, { l: x.focusOffset });
        }


        function getSelectionText() {
            return window.getSelection().toString();
        }

        function getSelectionStart() {
            var x = window.getSelection();
            return getNodePosition(x.anchorNode, x.anchorOffset);
        }

        function getNextNode(node) {
            if (node.firstChild) {
                return node.firstChild;
            }

            if (node.nextSibling) {
                return node.nextSibling;
            }

            if (node.parentNode && node.parentNode.id !== "myContent" && node.parentNode.nextSibling) {
                if (node.parentNode.nextSibling.firstChild) {
                    return node.parentNode.nextSibling;
                }
                return node.parentNode.nextSibling;
            }

            if (node.parentNode && node.parentNode && node.parentNode.parentNode.id !== "myContent" &&
                node.parentNode.parentNode.nextSibling) {
                if (node.parentNode.parentNode.nextSibling.firstChild) {
                    return node.parentNode.parentNode.nextSibling;
                }
            }

            return null;
        }

        function setCursorPosition(pos) {
            if (pos < 0) {
                return;
            }

            var extra = 0;
            var node = document.getElementById("myContent").firstChild;
            var firstNode = true;
            var i = 0;
            var idx = 0;
            while (node && i < 100) {
                i++;
                if (node.nodeName === "BR") {
                    extra++;
                    pos--;
                } else if (!firstNode && node.nodeName === "P") {
                    extra++;
                    pos--;
                } else if (node.nodeType === Node.TEXT_NODE && node.nodeValue) {
                    if (node.nodeValue && idx + extra + node.nodeValue.length >= pos) {
                        var range = document.createRange();
                        var sel = window.getSelection();
                        var newIdx = pos - idx - extra;
                        if (newIdx < 0) {
                            newIdx = 0;
                        }
                        range.setStart(node, newIdx);
                        range.collapse(true);
                        sel.removeAllRanges();
                        sel.addRange(range);
                        return;
                    }

                    idx += node.nodeValue.length;
                }
                node = getNextNode(node);
                firstNode = false;
            }
        }

        function setTextDirection(align, dir) {
            var element = document.getElementById("myContent");
            element.setAttribute("style", align);
            element.setAttribute("dir", dir);
        }

        function GetTextRecur(node, txtObj, first) {
            while (node != null) {
                if (node.firstChild) {
                    if (!first && (node.nodeName === "P" || node.nodeName === "DIV")) {
                        txtObj.v += "\r\n";
                    }
                    GetTextRecur(node.firstChild, txtObj, false);
                } else {
                    if (node.nodeType === 3) {
                        txtObj.v += node.nodeValue;
                    } else if (node.nodeName === "P" || node.nodeName === "DIV") {
                        txtObj.v += "\r\n";
                    } else if (node.nodeName === "BR" && node.parentNode.nodeName !== "P" && node.parentNode.nodeName !== "DIV") {
                        txtObj.v += "\r\n";
                    } else if (node.innerHTML === "<br>" && node.nodeName !== "P" && node.nodeName !== "DIV") {
                        if (node.parentNode && node.parentNode.nodeName !== "P" && node.parentNode.nodeName !== "DIV") {
                            txtObj.v += "\r\n";
                        }
                    }
                }
                first = false;
                node = node.nextSibling;
            }
            return txtObj.v;
        }

        function getText() {
            var text = GetTextRecur(getById("myContent").firstChild, { v: "" }, true);
            return text;
        }

        function setText(text) {
            document.getElementById("myContent").innerText = text;
        }

        function getEnabled() {
            return !document.getElementById("myContent").hasAttribute("disabled");
        }

        function setEnabled(enable) {
            if (enable) {
                var mc = document.getElementById("myContent");
                mc.removeAttribute('disabled');
                mc.className = "";
            } else {
                document.getElementById("myContent").setAttribute('disabled', 'disabled');
                document.getElementById("myContent").setAttribute('class', 'disabled');
            }
        }

        function setHtml(newHtml) {
            var r = getCursorPosition();
            document.getElementById("myContent").innerHTML = newHtml;
            setCursorPosition(r);
        }

        function getHtml() {
            return document.getElementById("myContent").innerHTML;
        }
    </script>
</body>
</html>